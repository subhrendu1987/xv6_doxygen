\hypertarget{sysfile_8c_source}{}\doxysection{sysfile.\+c}
\mbox{\hyperlink{sysfile_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00001}00001 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00002}00002 \textcolor{comment}{// File-\/system system calls.}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00003}00003 \textcolor{comment}{// Mostly argument checking, since we don't trust}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00004}00004 \textcolor{comment}{// user code, and calls into file.c and fs.c.}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00005}00005 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00006}00006 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00007}00007 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{types_8h}{types.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00008}00008 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{defs_8h}{defs.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00009}00009 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{param_8h}{param.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00010}00010 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{stat_8h}{stat.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00011}00011 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{mmu_8h}{mmu.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00012}00012 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{proc_8h}{proc.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00013}00013 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{fs_8h}{fs.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00014}00014 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{spinlock_8h}{spinlock.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00015}00015 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{sleeplock_8h}{sleeplock.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00016}00016 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{file_8h}{file.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00017}00017 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{fcntl_8h}{fcntl.h}}"{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00019}00019 \textcolor{comment}{// Fetch the nth word-\/sized system call argument as a file descriptor}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00020}00020 \textcolor{comment}{// and return both the descriptor and the corresponding struct file.}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00021}00021 \textcolor{keyword}{static} \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00022}00022 argfd(\textcolor{keywordtype}{int} n, \textcolor{keywordtype}{int} *pfd, \textcolor{keyword}{struct} \mbox{\hyperlink{structfile}{file}} **pf)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00023}00023 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00024}00024   \textcolor{keywordtype}{int} fd;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00025}00025   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00027}00027   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(n, \&fd) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00028}00028     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00029}00029   \textcolor{keywordflow}{if}(fd < 0 || fd >= \mbox{\hyperlink{param_8h_a80bacbaea8dd6aecf216d85d981bcb21}{NOFILE}} || (f=\mbox{\hyperlink{defs_8h_a3d2327db1e34643f4a9e6a07c8cc62c6}{myproc}}()-\/>ofile[fd]) == 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00030}00030     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00031}00031   \textcolor{keywordflow}{if}(pfd)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00032}00032     *pfd = fd;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00033}00033   \textcolor{keywordflow}{if}(pf)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00034}00034     *pf = f;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00035}00035   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00036}00036 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00037}00037 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00038}00038 \textcolor{comment}{// Allocate a file descriptor for the given file.}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00039}00039 \textcolor{comment}{// Takes over file reference from caller on success.}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00040}00040 \textcolor{keyword}{static} \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00041}00041 fdalloc(\textcolor{keyword}{struct} \mbox{\hyperlink{structfile}{file}} *f)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00042}00042 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00043}00043   \textcolor{keywordtype}{int} fd;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00044}00044   \textcolor{keyword}{struct }\mbox{\hyperlink{structproc}{proc}} *curproc = \mbox{\hyperlink{defs_8h_a3d2327db1e34643f4a9e6a07c8cc62c6}{myproc}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00045}00045 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00046}00046   \textcolor{keywordflow}{for}(fd = 0; fd < \mbox{\hyperlink{param_8h_a80bacbaea8dd6aecf216d85d981bcb21}{NOFILE}}; fd++)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00047}00047     \textcolor{keywordflow}{if}(curproc-\/>\mbox{\hyperlink{structproc_a4a9eb0352efe3fc097c91fccfaac50bd}{ofile}}[fd] == 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00048}00048       curproc-\/>\mbox{\hyperlink{structproc_a4a9eb0352efe3fc097c91fccfaac50bd}{ofile}}[fd] = f;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00049}00049       \textcolor{keywordflow}{return} fd;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00050}00050     \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00051}00051   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00052}00052   \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00053}00053 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00054}00054 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00055}00055 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00056}\mbox{\hyperlink{syscall_8c_a8f8b9e2d98e8b444f23a39ae8992feff}{00056}} \mbox{\hyperlink{sysfile_8c_a8f8b9e2d98e8b444f23a39ae8992feff}{sys\_dup}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00057}00057 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00058}00058   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00059}00059   \textcolor{keywordtype}{int} fd;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00061}00061   \textcolor{keywordflow}{if}(argfd(0, 0, \&f) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00062}00062     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00063}00063   \textcolor{keywordflow}{if}((fd=fdalloc(f)) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00064}00064     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00065}00065   \mbox{\hyperlink{defs_8h_a67aac4011147fe1ec585211e23580721}{filedup}}(f);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00066}00066   \textcolor{keywordflow}{return} fd;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00067}00067 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00068}00068 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00069}00069 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00070}\mbox{\hyperlink{syscall_8c_a54bf714d9e898cbdcbc061b280bbfae0}{00070}} \mbox{\hyperlink{sysfile_8c_a54bf714d9e898cbdcbc061b280bbfae0}{sys\_read}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00071}00071 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00072}00072   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00073}00073   \textcolor{keywordtype}{int} n;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00074}00074   \textcolor{keywordtype}{char} *p;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00075}00075 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00076}00076   \textcolor{keywordflow}{if}(argfd(0, 0, \&f) < 0 || \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(2, \&n) < 0 || \mbox{\hyperlink{defs_8h_a05c7464938c27eb91540c06ec6137f26}{argptr}}(1, \&p, n) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00077}00077     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00078}00078   \textcolor{keywordflow}{return} \mbox{\hyperlink{defs_8h_a6bd1db179155944c9d1fbc89d8b7b162}{fileread}}(f, p, n);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00079}00079 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00080}00080 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00081}00081 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00082}\mbox{\hyperlink{syscall_8c_a687d939a9e4792af15db96f2c2f34378}{00082}} \mbox{\hyperlink{sysfile_8c_a687d939a9e4792af15db96f2c2f34378}{sys\_write}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00083}00083 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00084}00084   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00085}00085   \textcolor{keywordtype}{int} n;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00086}00086   \textcolor{keywordtype}{char} *p;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00087}00087 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00088}00088   \textcolor{keywordflow}{if}(argfd(0, 0, \&f) < 0 || \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(2, \&n) < 0 || \mbox{\hyperlink{defs_8h_a05c7464938c27eb91540c06ec6137f26}{argptr}}(1, \&p, n) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00089}00089     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00090}00090   \textcolor{keywordflow}{return} \mbox{\hyperlink{defs_8h_a90e8980df48fa900fc33de53448a2e18}{filewrite}}(f, p, n);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00091}00091 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00092}00092 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00093}00093 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00094}\mbox{\hyperlink{syscall_8c_a32945488fd39bc405757177b37cd2250}{00094}} \mbox{\hyperlink{sysfile_8c_a32945488fd39bc405757177b37cd2250}{sys\_close}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00095}00095 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00096}00096   \textcolor{keywordtype}{int} fd;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00097}00097   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00098}00098 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00099}00099   \textcolor{keywordflow}{if}(argfd(0, \&fd, \&f) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00100}00100     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00101}00101   \mbox{\hyperlink{defs_8h_a3d2327db1e34643f4a9e6a07c8cc62c6}{myproc}}()-\/>\mbox{\hyperlink{structproc_a4a9eb0352efe3fc097c91fccfaac50bd}{ofile}}[fd] = 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00102}00102   \mbox{\hyperlink{defs_8h_ac865ee0b2d70f753d61d1fefef9de0f6}{fileclose}}(f);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00103}00103   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00104}00104 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00105}00105 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00106}00106 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00107}\mbox{\hyperlink{syscall_8c_ac243c8f20f5fb2e3e257b5007af2c204}{00107}} \mbox{\hyperlink{sysfile_8c_ac243c8f20f5fb2e3e257b5007af2c204}{sys\_fstat}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00108}00108 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00109}00109   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00110}00110   \textcolor{keyword}{struct }\mbox{\hyperlink{structstat}{stat}} *st;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00112}00112   \textcolor{keywordflow}{if}(argfd(0, 0, \&f) < 0 || \mbox{\hyperlink{defs_8h_a05c7464938c27eb91540c06ec6137f26}{argptr}}(1, (\textcolor{keywordtype}{void}*)\&st, \textcolor{keyword}{sizeof}(*st)) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00113}00113     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00114}00114   \textcolor{keywordflow}{return} \mbox{\hyperlink{defs_8h_ac4979f97957194db01001985b1bfa84e}{filestat}}(f, st);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00115}00115 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00116}00116 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00117}00117 \textcolor{comment}{// Create the path new as a link to the same inode as old.}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00118}00118 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00119}\mbox{\hyperlink{syscall_8c_a759600870314007ac558871239122fb7}{00119}} \mbox{\hyperlink{sysfile_8c_a759600870314007ac558871239122fb7}{sys\_link}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00120}00120 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00121}00121   \textcolor{keywordtype}{char} \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}[\mbox{\hyperlink{fs_8h_a48246fb9e5cb7f6a71ebc9ebc2f06562}{DIRSIZ}}], *\textcolor{keyword}{new}, *old;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00122}00122   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *dp, *ip;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00123}00123 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00124}00124   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&old) < 0 || \mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(1, \&\textcolor{keyword}{new}) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00125}00125     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00126}00126 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00127}00127   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00128}00128   \textcolor{keywordflow}{if}((ip = \mbox{\hyperlink{defs_8h_acde7d3975db286253e584452ba03a54f}{namei}}(old)) == 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00129}00129     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00130}00130     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00131}00131   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00132}00132 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00133}00133   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00134}00134   \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}})\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00135}00135     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00136}00136     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00137}00137     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00138}00138   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00139}00139 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00140}00140   ip-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}}++;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00141}00141   \mbox{\hyperlink{defs_8h_a2ee6784c123b2a2656d88b5b357f2253}{iupdate}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00142}00142   \mbox{\hyperlink{defs_8h_af301c10ad8ced77a5dfb2de3a64c666c}{iunlock}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00143}00143 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00144}00144   \textcolor{keywordflow}{if}((dp = \mbox{\hyperlink{defs_8h_a699674601988291ebcc47d902f18bee8}{nameiparent}}(\textcolor{keyword}{new}, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}})) == 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00145}00145     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00146}00146   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00147}00147   \textcolor{keywordflow}{if}(dp-\/>\mbox{\hyperlink{structinode_a121742a89c4531f03a7de1613d5be605}{dev}} != ip-\/>\mbox{\hyperlink{structinode_a121742a89c4531f03a7de1613d5be605}{dev}} || \mbox{\hyperlink{defs_8h_ae4ccea0aa02557162963e597737f665a}{dirlink}}(dp, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}, ip-\/>\mbox{\hyperlink{structinode_a8acc2b9df0bfc6856da62925763db7fe}{inum}}) < 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00148}00148     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00149}00149     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00150}00150   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00151}00151   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00152}00152   \mbox{\hyperlink{defs_8h_a29530a0afdfe924818d8c70b6724528d}{iput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00153}00153 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00154}00154   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00155}00155 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00156}00156   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00157}00157 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00158}00158 bad:}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00159}00159   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00160}00160   ip-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}}-\/-\/;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00161}00161   \mbox{\hyperlink{defs_8h_a2ee6784c123b2a2656d88b5b357f2253}{iupdate}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00162}00162   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00163}00163   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00164}00164   \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00165}00165 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00166}00166 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00167}00167 \textcolor{comment}{// Is the directory dp empty except for "{}."{} and "{}.."{} ?}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00168}00168 \textcolor{keyword}{static} \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00169}00169 isdirempty(\textcolor{keyword}{struct} \mbox{\hyperlink{structinode}{inode}} *dp)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00170}00170 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00171}00171   \textcolor{keywordtype}{int} off;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00172}00172   \textcolor{keyword}{struct }\mbox{\hyperlink{structdirent}{dirent}} de;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00173}00173 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00174}00174   \textcolor{keywordflow}{for}(off=2*\textcolor{keyword}{sizeof}(de); off<dp-\/>\mbox{\hyperlink{structinode_a918af769c48a8ca8afac057bf83d12de}{size}}; off+=\textcolor{keyword}{sizeof}(de))\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00175}00175     \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a2415273b06f31f0f2587b7325588a7e4}{readi}}(dp, (\textcolor{keywordtype}{char}*)\&de, off, \textcolor{keyword}{sizeof}(de)) != \textcolor{keyword}{sizeof}(de))}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00176}00176       \mbox{\hyperlink{console_8c_a95c0aca5d6d7487933984f08b189917a}{panic}}(\textcolor{stringliteral}{"{}isdirempty: readi"{}});}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00177}00177     \textcolor{keywordflow}{if}(de.inum != 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00178}00178       \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00179}00179   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00180}00180   \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00181}00181 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00182}00182 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00183}00183 \textcolor{comment}{//PAGEBREAK!}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00184}00184 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00185}\mbox{\hyperlink{syscall_8c_ae1e58ee11d41f643929520d8c1640da7}{00185}} \mbox{\hyperlink{sysfile_8c_ae1e58ee11d41f643929520d8c1640da7}{sys\_unlink}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00186}00186 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00187}00187   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip, *dp;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00188}00188   \textcolor{keyword}{struct }\mbox{\hyperlink{structdirent}{dirent}} de;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00189}00189   \textcolor{keywordtype}{char} \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}[\mbox{\hyperlink{fs_8h_a48246fb9e5cb7f6a71ebc9ebc2f06562}{DIRSIZ}}], *path;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00190}00190   \mbox{\hyperlink{types_8h_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}} off;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00191}00191 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00192}00192   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00193}00193     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00194}00194 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00195}00195   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00196}00196   \textcolor{keywordflow}{if}((dp = \mbox{\hyperlink{defs_8h_a699674601988291ebcc47d902f18bee8}{nameiparent}}(path, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}})) == 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00197}00197     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00198}00198     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00199}00199   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00200}00200 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00201}00201   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00202}00202 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00203}00203   \textcolor{comment}{// Cannot unlink "{}."{} or "{}.."{}.}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00204}00204   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a0206c4090dc4bdfd8481e38057d5b2af}{namecmp}}(\mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}, \textcolor{stringliteral}{"{}."{}}) == 0 || \mbox{\hyperlink{defs_8h_a0206c4090dc4bdfd8481e38057d5b2af}{namecmp}}(\mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}, \textcolor{stringliteral}{"{}.."{}}) == 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00205}00205     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00206}00206 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00207}00207   \textcolor{keywordflow}{if}((ip = \mbox{\hyperlink{defs_8h_aef19d16d1d20d8f7cdcd8ee0d98fc13f}{dirlookup}}(dp, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}, \&off)) == 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00208}00208     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00209}00209   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00210}00210 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00211}00211   \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}} < 1)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00212}00212     \mbox{\hyperlink{console_8c_a95c0aca5d6d7487933984f08b189917a}{panic}}(\textcolor{stringliteral}{"{}unlink: nlink < 1"{}});}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00213}00213   \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}} \&\& !isdirempty(ip))\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00214}00214     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00215}00215     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00216}00216   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00217}00217 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00218}00218   \mbox{\hyperlink{defs_8h_a0098886a849eef10803e9f35ceec61b9}{memset}}(\&de, 0, \textcolor{keyword}{sizeof}(de));}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00219}00219   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a515876d4653cefef4732806ef7f2833f}{writei}}(dp, (\textcolor{keywordtype}{char}*)\&de, off, \textcolor{keyword}{sizeof}(de)) != \textcolor{keyword}{sizeof}(de))}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00220}00220     \mbox{\hyperlink{console_8c_a95c0aca5d6d7487933984f08b189917a}{panic}}(\textcolor{stringliteral}{"{}unlink: writei"{}});}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00221}00221   \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}})\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00222}00222     dp-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}}-\/-\/;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00223}00223     \mbox{\hyperlink{defs_8h_a2ee6784c123b2a2656d88b5b357f2253}{iupdate}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00224}00224   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00225}00225   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00226}00226 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00227}00227   ip-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}}-\/-\/;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00228}00228   \mbox{\hyperlink{defs_8h_a2ee6784c123b2a2656d88b5b357f2253}{iupdate}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00229}00229   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00230}00230 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00231}00231   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00232}00232 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00233}00233   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00234}00234 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00235}00235 bad:}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00236}00236   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00237}00237   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00238}00238   \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00239}00239 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00240}00240 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00241}00241 \textcolor{keyword}{static} \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}}*}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00242}00242 create(\textcolor{keywordtype}{char} *path, \textcolor{keywordtype}{short} \mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}}, \textcolor{keywordtype}{short} \mbox{\hyperlink{structinode_a34af7242018a977dace5730683850875}{major}}, \textcolor{keywordtype}{short} \mbox{\hyperlink{structinode_a37878866e7905b666db2aa33076076a2}{minor}})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00243}00243 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00244}00244   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip, *dp;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00245}00245   \textcolor{keywordtype}{char} \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}[\mbox{\hyperlink{fs_8h_a48246fb9e5cb7f6a71ebc9ebc2f06562}{DIRSIZ}}];}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00246}00246 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00247}00247   \textcolor{keywordflow}{if}((dp = \mbox{\hyperlink{defs_8h_a699674601988291ebcc47d902f18bee8}{nameiparent}}(path, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}})) == 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00248}00248     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00249}00249   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00250}00250 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00251}00251   \textcolor{keywordflow}{if}((ip = \mbox{\hyperlink{defs_8h_aef19d16d1d20d8f7cdcd8ee0d98fc13f}{dirlookup}}(dp, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}, 0)) != 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00252}00252     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00253}00253     \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00254}00254     \textcolor{keywordflow}{if}(\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a0a8afbed81f5fb3930e9d153fbd51737}{T\_FILE}} \&\& ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a0a8afbed81f5fb3930e9d153fbd51737}{T\_FILE}})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00255}00255       \textcolor{keywordflow}{return} ip;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00256}00256     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00257}00257     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00258}00258   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00259}00259 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00260}00260   \textcolor{keywordflow}{if}((ip = \mbox{\hyperlink{defs_8h_af71d7632e6d48638682e78de0ad269af}{ialloc}}(dp-\/>\mbox{\hyperlink{structinode_a121742a89c4531f03a7de1613d5be605}{dev}}, \mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}})) == 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00261}00261     \mbox{\hyperlink{console_8c_a95c0aca5d6d7487933984f08b189917a}{panic}}(\textcolor{stringliteral}{"{}create: ialloc"{}});}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00262}00262 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00263}00263   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00264}00264   ip-\/>\mbox{\hyperlink{structinode_a34af7242018a977dace5730683850875}{major}} = \mbox{\hyperlink{structinode_a34af7242018a977dace5730683850875}{major}};}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00265}00265   ip-\/>\mbox{\hyperlink{structinode_a37878866e7905b666db2aa33076076a2}{minor}} = \mbox{\hyperlink{structinode_a37878866e7905b666db2aa33076076a2}{minor}};}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00266}00266   ip-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}} = 1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00267}00267   \mbox{\hyperlink{defs_8h_a2ee6784c123b2a2656d88b5b357f2253}{iupdate}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00268}00268 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00269}00269   \textcolor{keywordflow}{if}(\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}})\{  \textcolor{comment}{// Create . and .. entries.}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00270}00270     dp-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}}++;  \textcolor{comment}{// for "{}.."{}}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00271}00271     \mbox{\hyperlink{defs_8h_a2ee6784c123b2a2656d88b5b357f2253}{iupdate}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00272}00272     \textcolor{comment}{// No ip-\/>nlink++ for "{}."{}: avoid cyclic ref count.}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00273}00273     \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_ae4ccea0aa02557162963e597737f665a}{dirlink}}(ip, \textcolor{stringliteral}{"{}."{}}, ip-\/>\mbox{\hyperlink{structinode_a8acc2b9df0bfc6856da62925763db7fe}{inum}}) < 0 || \mbox{\hyperlink{defs_8h_ae4ccea0aa02557162963e597737f665a}{dirlink}}(ip, \textcolor{stringliteral}{"{}.."{}}, dp-\/>\mbox{\hyperlink{structinode_a8acc2b9df0bfc6856da62925763db7fe}{inum}}) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00274}00274       \mbox{\hyperlink{console_8c_a95c0aca5d6d7487933984f08b189917a}{panic}}(\textcolor{stringliteral}{"{}create dots"{}});}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00275}00275   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00276}00276 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00277}00277   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_ae4ccea0aa02557162963e597737f665a}{dirlink}}(dp, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}, ip-\/>\mbox{\hyperlink{structinode_a8acc2b9df0bfc6856da62925763db7fe}{inum}}) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00278}00278     \mbox{\hyperlink{console_8c_a95c0aca5d6d7487933984f08b189917a}{panic}}(\textcolor{stringliteral}{"{}create: dirlink"{}});}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00279}00279 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00280}00280   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(dp);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00281}00281 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00282}00282   \textcolor{keywordflow}{return} ip;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00283}00283 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00284}00284 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00285}00285 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00286}\mbox{\hyperlink{syscall_8c_a74e45efc661ca17c068bc283b3842e6d}{00286}} \mbox{\hyperlink{sysfile_8c_a74e45efc661ca17c068bc283b3842e6d}{sys\_open}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00287}00287 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00288}00288   \textcolor{keywordtype}{char} *path;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00289}00289   \textcolor{keywordtype}{int} fd, omode;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00290}00290   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00291}00291   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00292}00292 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00293}00293   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path) < 0 || \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(1, \&omode) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00294}00294     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00295}00295 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00296}00296   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00297}00297 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00298}00298   \textcolor{keywordflow}{if}(omode \& \mbox{\hyperlink{fcntl_8h_ab40a23079c3b9a7e25ffdc8108c7fb02}{O\_CREATE}})\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00299}00299     ip = create(path, \mbox{\hyperlink{stat_8h_a0a8afbed81f5fb3930e9d153fbd51737}{T\_FILE}}, 0, 0);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00300}00300     \textcolor{keywordflow}{if}(ip == 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00301}00301       \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00302}00302       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00303}00303     \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00304}00304   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00305}00305     \textcolor{keywordflow}{if}((ip = \mbox{\hyperlink{defs_8h_acde7d3975db286253e584452ba03a54f}{namei}}(path)) == 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00306}00306       \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00307}00307       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00308}00308     \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00309}00309     \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00310}00310     \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}} \&\& omode != \mbox{\hyperlink{fcntl_8h_a7a68c9ffaac7dbcd652225dd7c06a54b}{O\_RDONLY}})\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00311}00311       \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00312}00312       \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00313}00313       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00314}00314     \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00315}00315   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00316}00316 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00317}00317   \textcolor{keywordflow}{if}((f = \mbox{\hyperlink{defs_8h_ac56b15561658d0e74ce1c53309b8f97d}{filealloc}}()) == 0 || (fd = fdalloc(f)) < 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00318}00318     \textcolor{keywordflow}{if}(f)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00319}00319       \mbox{\hyperlink{defs_8h_ac865ee0b2d70f753d61d1fefef9de0f6}{fileclose}}(f);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00320}00320     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00321}00321     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00322}00322     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00323}00323   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00324}00324   \mbox{\hyperlink{defs_8h_af301c10ad8ced77a5dfb2de3a64c666c}{iunlock}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00325}00325   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00326}00326 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00327}00327   f-\/>\mbox{\hyperlink{structfile_a3a28c808a8dcd4acf45087ac30c075e7}{type}} = FD\_INODE;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00328}00328   f-\/>\mbox{\hyperlink{structfile_a4fd095f927715574dc2a4f243690e508}{ip}} = ip;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00329}00329   f-\/>\mbox{\hyperlink{structfile_a94a911be6cc1b1326728392d8b40150d}{off}} = 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00330}00330   f-\/>\mbox{\hyperlink{structfile_a0c5c8eced8bc562dbbecc8d450a6b646}{readable}} = !(omode \& \mbox{\hyperlink{fcntl_8h_a11b644a8526139c4cc1850dac1271ced}{O\_WRONLY}});}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00331}00331   f-\/>\mbox{\hyperlink{structfile_a6e1b641ea1551ac4316a0c11a683df45}{writable}} = (omode \& \mbox{\hyperlink{fcntl_8h_a11b644a8526139c4cc1850dac1271ced}{O\_WRONLY}}) || (omode \& \mbox{\hyperlink{fcntl_8h_abb0586253488ee61072b73557eeb873b}{O\_RDWR}});}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00332}00332   \textcolor{keywordflow}{return} fd;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00333}00333 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00334}00334 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00335}00335 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00336}\mbox{\hyperlink{syscall_8c_a057e5bce2de7a87ebfd2dc33967bca4a}{00336}} \mbox{\hyperlink{sysfile_8c_a057e5bce2de7a87ebfd2dc33967bca4a}{sys\_mkdir}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00337}00337 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00338}00338   \textcolor{keywordtype}{char} *path;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00339}00339   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00340}00340 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00341}00341   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00342}00342   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path) < 0 || (ip = create(path, \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}}, 0, 0)) == 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00343}00343     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00344}00344     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00345}00345   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00346}00346   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00347}00347   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00348}00348   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00349}00349 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00350}00350 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00351}00351 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00352}\mbox{\hyperlink{syscall_8c_a25697aa3d828b5878d38170d724adb27}{00352}} \mbox{\hyperlink{sysfile_8c_a25697aa3d828b5878d38170d724adb27}{sys\_mknod}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00353}00353 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00354}00354   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00355}00355   \textcolor{keywordtype}{char} *path;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00356}00356   \textcolor{keywordtype}{int} \mbox{\hyperlink{structinode_a34af7242018a977dace5730683850875}{major}}, \mbox{\hyperlink{structinode_a37878866e7905b666db2aa33076076a2}{minor}};}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00357}00357 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00358}00358   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00359}00359   \textcolor{keywordflow}{if}((\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path)) < 0 ||}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00360}00360      \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(1, \&\mbox{\hyperlink{structinode_a34af7242018a977dace5730683850875}{major}}) < 0 ||}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00361}00361      \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(2, \&\mbox{\hyperlink{structinode_a37878866e7905b666db2aa33076076a2}{minor}}) < 0 ||}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00362}00362      (ip = create(path, \mbox{\hyperlink{stat_8h_a62b045a3e4fdf204bdddda0f3fc3d8c4}{T\_DEV}}, \mbox{\hyperlink{structinode_a34af7242018a977dace5730683850875}{major}}, \mbox{\hyperlink{structinode_a37878866e7905b666db2aa33076076a2}{minor}})) == 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00363}00363     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00364}00364     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00365}00365   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00366}00366   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00367}00367   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00368}00368   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00369}00369 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00370}00370 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00371}00371 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00372}\mbox{\hyperlink{syscall_8c_ad1c5f8693cb35b9605fee09eebdda640}{00372}} \mbox{\hyperlink{sysfile_8c_ad1c5f8693cb35b9605fee09eebdda640}{sys\_chdir}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00373}00373 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00374}00374   \textcolor{keywordtype}{char} *path;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00375}00375   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00376}00376   \textcolor{keyword}{struct }\mbox{\hyperlink{structproc}{proc}} *curproc = \mbox{\hyperlink{defs_8h_a3d2327db1e34643f4a9e6a07c8cc62c6}{myproc}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00377}00377   }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00378}00378   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00379}00379   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path) < 0 || (ip = \mbox{\hyperlink{defs_8h_acde7d3975db286253e584452ba03a54f}{namei}}(path)) == 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00380}00380     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00381}00381     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00382}00382   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00383}00383   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00384}00384   \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} != \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}})\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00385}00385     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00386}00386     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00387}00387     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00388}00388   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00389}00389   \mbox{\hyperlink{defs_8h_af301c10ad8ced77a5dfb2de3a64c666c}{iunlock}}(ip);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00390}00390   \mbox{\hyperlink{defs_8h_a29530a0afdfe924818d8c70b6724528d}{iput}}(curproc-\/>\mbox{\hyperlink{structproc_a493bc338ce008a838eef521972a35257}{cwd}});}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00391}00391   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00392}00392   curproc-\/>\mbox{\hyperlink{structproc_a493bc338ce008a838eef521972a35257}{cwd}} = ip;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00393}00393   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00394}00394 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00395}00395 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00396}00396 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00397}\mbox{\hyperlink{syscall_8c_aeaa813ddeb6a5fac3c45714c7351c526}{00397}} \mbox{\hyperlink{sysfile_8c_aeaa813ddeb6a5fac3c45714c7351c526}{sys\_exec}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00398}00398 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00399}00399   \textcolor{keywordtype}{char} *path, *\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}[\mbox{\hyperlink{param_8h_a4c171d1ccc50f0b6ce7ad2f475eeba32}{MAXARG}}];}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00400}00400   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00401}00401   \mbox{\hyperlink{types_8h_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}} uargv, uarg;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00402}00402 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00403}00403   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path) < 0 || \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(1, (\textcolor{keywordtype}{int}*)\&uargv) < 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00404}00404     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00405}00405   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00406}00406   \mbox{\hyperlink{defs_8h_a0098886a849eef10803e9f35ceec61b9}{memset}}(\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}, 0, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}));}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00407}00407   \textcolor{keywordflow}{for}(i=0;; i++)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00408}00408     \textcolor{keywordflow}{if}(i >= \mbox{\hyperlink{defs_8h_afacd331296c10f360da7640e0d68429f}{NELEM}}(\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}))}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00409}00409       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00410}00410     \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_ab8c95490fad429ac2701653041f2efcf}{fetchint}}(uargv+4*i, (\textcolor{keywordtype}{int}*)\&uarg) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00411}00411       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00412}00412     \textcolor{keywordflow}{if}(uarg == 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00413}00413       \mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}[i] = 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00414}00414       \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00415}00415     \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00416}00416     \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a386d969a02c926521cf2e1816069a4dc}{fetchstr}}(uarg, \&\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}[i]) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00417}00417       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00418}00418   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00419}00419   \textcolor{keywordflow}{return} \mbox{\hyperlink{defs_8h_aa7b4aae4a12acd187e23396214aeca47}{exec}}(path, \mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}});}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00420}00420 \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00421}00421 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00422}00422 \textcolor{keywordtype}{int}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00423}\mbox{\hyperlink{syscall_8c_a9a70db941def46ec25939e6c2d30e399}{00423}} \mbox{\hyperlink{sysfile_8c_a9a70db941def46ec25939e6c2d30e399}{sys\_pipe}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00424}00424 \{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00425}00425   \textcolor{keywordtype}{int} *fd;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00426}00426   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *rf, *wf;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00427}00427   \textcolor{keywordtype}{int} fd0, fd1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00428}00428 }
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00429}00429   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a05c7464938c27eb91540c06ec6137f26}{argptr}}(0, (\textcolor{keywordtype}{void}*)\&fd, 2*\textcolor{keyword}{sizeof}(fd[0])) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00430}00430     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00431}00431   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a3de41eab56ff42bea4d1ae78bbd1e472}{pipealloc}}(\&rf, \&wf) < 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00432}00432     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00433}00433   fd0 = -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00434}00434   \textcolor{keywordflow}{if}((fd0 = fdalloc(rf)) < 0 || (fd1 = fdalloc(wf)) < 0)\{}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00435}00435     \textcolor{keywordflow}{if}(fd0 >= 0)}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00436}00436       \mbox{\hyperlink{defs_8h_a3d2327db1e34643f4a9e6a07c8cc62c6}{myproc}}()-\/>\mbox{\hyperlink{structproc_a4a9eb0352efe3fc097c91fccfaac50bd}{ofile}}[fd0] = 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00437}00437     \mbox{\hyperlink{defs_8h_ac865ee0b2d70f753d61d1fefef9de0f6}{fileclose}}(rf);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00438}00438     \mbox{\hyperlink{defs_8h_ac865ee0b2d70f753d61d1fefef9de0f6}{fileclose}}(wf);}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00439}00439     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00440}00440   \}}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00441}00441   fd[0] = fd0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00442}00442   fd[1] = fd1;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00443}00443   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{sysfile_8c_source_l00444}00444 \}}

\end{DoxyCode}
