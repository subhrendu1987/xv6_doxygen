\hypertarget{sysfile_8c}{}\doxysection{sysfile.\+c File Reference}
\label{sysfile_8c}\index{sysfile.c@{sysfile.c}}
{\ttfamily \#include \char`\"{}types.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}defs.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}param.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}stat.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mmu.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}proc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}fs.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}spinlock.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}sleeplock.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}file.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}fcntl.\+h\char`\"{}}\newline
Include dependency graph for sysfile.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/de8/sysfile_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{sysfile_8c_a8f8b9e2d98e8b444f23a39ae8992feff}{sys\+\_\+dup}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_a54bf714d9e898cbdcbc061b280bbfae0}{sys\+\_\+read}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_a687d939a9e4792af15db96f2c2f34378}{sys\+\_\+write}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_a32945488fd39bc405757177b37cd2250}{sys\+\_\+close}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_ac243c8f20f5fb2e3e257b5007af2c204}{sys\+\_\+fstat}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_a759600870314007ac558871239122fb7}{sys\+\_\+link}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_ae1e58ee11d41f643929520d8c1640da7}{sys\+\_\+unlink}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_a74e45efc661ca17c068bc283b3842e6d}{sys\+\_\+open}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_a057e5bce2de7a87ebfd2dc33967bca4a}{sys\+\_\+mkdir}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_a25697aa3d828b5878d38170d724adb27}{sys\+\_\+mknod}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_ad1c5f8693cb35b9605fee09eebdda640}{sys\+\_\+chdir}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_aeaa813ddeb6a5fac3c45714c7351c526}{sys\+\_\+exec}} (void)
\item 
int \mbox{\hyperlink{sysfile_8c_a9a70db941def46ec25939e6c2d30e399}{sys\+\_\+pipe}} (void)
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{sysfile_8c_ad1c5f8693cb35b9605fee09eebdda640}\label{sysfile_8c_ad1c5f8693cb35b9605fee09eebdda640}} 
\index{sysfile.c@{sysfile.c}!sys\_chdir@{sys\_chdir}}
\index{sys\_chdir@{sys\_chdir}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_chdir()}{sys\_chdir()}}
{\footnotesize\ttfamily int sys\+\_\+chdir (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00372}{372}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00373 \{}
\DoxyCodeLine{00374   \textcolor{keywordtype}{char} *path;}
\DoxyCodeLine{00375   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip;}
\DoxyCodeLine{00376   \textcolor{keyword}{struct }\mbox{\hyperlink{structproc}{proc}} *curproc = \mbox{\hyperlink{defs_8h_a3d2327db1e34643f4a9e6a07c8cc62c6}{myproc}}();}
\DoxyCodeLine{00377   }
\DoxyCodeLine{00378   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{00379   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path) < 0 || (ip = \mbox{\hyperlink{defs_8h_acde7d3975db286253e584452ba03a54f}{namei}}(path)) == 0)\{}
\DoxyCodeLine{00380     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00381     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00382   \}}
\DoxyCodeLine{00383   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{00384   \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} != \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}})\{}
\DoxyCodeLine{00385     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{00386     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00387     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00388   \}}
\DoxyCodeLine{00389   \mbox{\hyperlink{defs_8h_af301c10ad8ced77a5dfb2de3a64c666c}{iunlock}}(ip);}
\DoxyCodeLine{00390   \mbox{\hyperlink{defs_8h_a29530a0afdfe924818d8c70b6724528d}{iput}}(curproc-\/>\mbox{\hyperlink{structproc_a493bc338ce008a838eef521972a35257}{cwd}});}
\DoxyCodeLine{00391   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00392   curproc-\/>\mbox{\hyperlink{structproc_a493bc338ce008a838eef521972a35257}{cwd}} = ip;}
\DoxyCodeLine{00393   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00394 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_ad1c5f8693cb35b9605fee09eebdda640_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_a32945488fd39bc405757177b37cd2250}\label{sysfile_8c_a32945488fd39bc405757177b37cd2250}} 
\index{sysfile.c@{sysfile.c}!sys\_close@{sys\_close}}
\index{sys\_close@{sys\_close}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_close()}{sys\_close()}}
{\footnotesize\ttfamily int sys\+\_\+close (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00094}{94}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00095 \{}
\DoxyCodeLine{00096   \textcolor{keywordtype}{int} fd;}
\DoxyCodeLine{00097   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{00098 }
\DoxyCodeLine{00099   \textcolor{keywordflow}{if}(argfd(0, \&fd, \&f) < 0)}
\DoxyCodeLine{00100     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00101   \mbox{\hyperlink{defs_8h_a3d2327db1e34643f4a9e6a07c8cc62c6}{myproc}}()-\/>\mbox{\hyperlink{structproc_a4a9eb0352efe3fc097c91fccfaac50bd}{ofile}}[fd] = 0;}
\DoxyCodeLine{00102   \mbox{\hyperlink{defs_8h_ac865ee0b2d70f753d61d1fefef9de0f6}{fileclose}}(f);}
\DoxyCodeLine{00103   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00104 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_a32945488fd39bc405757177b37cd2250_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_a8f8b9e2d98e8b444f23a39ae8992feff}\label{sysfile_8c_a8f8b9e2d98e8b444f23a39ae8992feff}} 
\index{sysfile.c@{sysfile.c}!sys\_dup@{sys\_dup}}
\index{sys\_dup@{sys\_dup}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_dup()}{sys\_dup()}}
{\footnotesize\ttfamily int sys\+\_\+dup (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00056}{56}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00057 \{}
\DoxyCodeLine{00058   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{00059   \textcolor{keywordtype}{int} fd;}
\DoxyCodeLine{00060 }
\DoxyCodeLine{00061   \textcolor{keywordflow}{if}(argfd(0, 0, \&f) < 0)}
\DoxyCodeLine{00062     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00063   \textcolor{keywordflow}{if}((fd=fdalloc(f)) < 0)}
\DoxyCodeLine{00064     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00065   \mbox{\hyperlink{defs_8h_a67aac4011147fe1ec585211e23580721}{filedup}}(f);}
\DoxyCodeLine{00066   \textcolor{keywordflow}{return} fd;}
\DoxyCodeLine{00067 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_a8f8b9e2d98e8b444f23a39ae8992feff_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_aeaa813ddeb6a5fac3c45714c7351c526}\label{sysfile_8c_aeaa813ddeb6a5fac3c45714c7351c526}} 
\index{sysfile.c@{sysfile.c}!sys\_exec@{sys\_exec}}
\index{sys\_exec@{sys\_exec}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_exec()}{sys\_exec()}}
{\footnotesize\ttfamily int sys\+\_\+exec (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00397}{397}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00398 \{}
\DoxyCodeLine{00399   \textcolor{keywordtype}{char} *path, *\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}[\mbox{\hyperlink{param_8h_a4c171d1ccc50f0b6ce7ad2f475eeba32}{MAXARG}}];}
\DoxyCodeLine{00400   \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{00401   \mbox{\hyperlink{types_8h_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}} uargv, uarg;}
\DoxyCodeLine{00402 }
\DoxyCodeLine{00403   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path) < 0 || \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(1, (\textcolor{keywordtype}{int}*)\&uargv) < 0)\{}
\DoxyCodeLine{00404     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00405   \}}
\DoxyCodeLine{00406   \mbox{\hyperlink{defs_8h_a0098886a849eef10803e9f35ceec61b9}{memset}}(\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}, 0, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}));}
\DoxyCodeLine{00407   \textcolor{keywordflow}{for}(i=0;; i++)\{}
\DoxyCodeLine{00408     \textcolor{keywordflow}{if}(i >= \mbox{\hyperlink{defs_8h_afacd331296c10f360da7640e0d68429f}{NELEM}}(\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}))}
\DoxyCodeLine{00409       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00410     \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_ab8c95490fad429ac2701653041f2efcf}{fetchint}}(uargv+4*i, (\textcolor{keywordtype}{int}*)\&uarg) < 0)}
\DoxyCodeLine{00411       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00412     \textcolor{keywordflow}{if}(uarg == 0)\{}
\DoxyCodeLine{00413       \mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}[i] = 0;}
\DoxyCodeLine{00414       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00415     \}}
\DoxyCodeLine{00416     \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a386d969a02c926521cf2e1816069a4dc}{fetchstr}}(uarg, \&\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}[i]) < 0)}
\DoxyCodeLine{00417       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00418   \}}
\DoxyCodeLine{00419   \textcolor{keywordflow}{return} \mbox{\hyperlink{defs_8h_aa7b4aae4a12acd187e23396214aeca47}{exec}}(path, \mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}});}
\DoxyCodeLine{00420 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_aeaa813ddeb6a5fac3c45714c7351c526_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_ac243c8f20f5fb2e3e257b5007af2c204}\label{sysfile_8c_ac243c8f20f5fb2e3e257b5007af2c204}} 
\index{sysfile.c@{sysfile.c}!sys\_fstat@{sys\_fstat}}
\index{sys\_fstat@{sys\_fstat}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_fstat()}{sys\_fstat()}}
{\footnotesize\ttfamily int sys\+\_\+fstat (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00107}{107}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00108 \{}
\DoxyCodeLine{00109   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{00110   \textcolor{keyword}{struct }\mbox{\hyperlink{structstat}{stat}} *st;}
\DoxyCodeLine{00111 }
\DoxyCodeLine{00112   \textcolor{keywordflow}{if}(argfd(0, 0, \&f) < 0 || \mbox{\hyperlink{defs_8h_a05c7464938c27eb91540c06ec6137f26}{argptr}}(1, (\textcolor{keywordtype}{void}*)\&st, \textcolor{keyword}{sizeof}(*st)) < 0)}
\DoxyCodeLine{00113     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00114   \textcolor{keywordflow}{return} \mbox{\hyperlink{defs_8h_ac4979f97957194db01001985b1bfa84e}{filestat}}(f, st);}
\DoxyCodeLine{00115 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_ac243c8f20f5fb2e3e257b5007af2c204_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_a759600870314007ac558871239122fb7}\label{sysfile_8c_a759600870314007ac558871239122fb7}} 
\index{sysfile.c@{sysfile.c}!sys\_link@{sys\_link}}
\index{sys\_link@{sys\_link}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_link()}{sys\_link()}}
{\footnotesize\ttfamily int sys\+\_\+link (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00119}{119}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00120 \{}
\DoxyCodeLine{00121   \textcolor{keywordtype}{char} \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}[\mbox{\hyperlink{fs_8h_a48246fb9e5cb7f6a71ebc9ebc2f06562}{DIRSIZ}}], *\textcolor{keyword}{new}, *old;}
\DoxyCodeLine{00122   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *dp, *ip;}
\DoxyCodeLine{00123 }
\DoxyCodeLine{00124   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&old) < 0 || \mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(1, \&\textcolor{keyword}{new}) < 0)}
\DoxyCodeLine{00125     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00126 }
\DoxyCodeLine{00127   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{00128   \textcolor{keywordflow}{if}((ip = \mbox{\hyperlink{defs_8h_acde7d3975db286253e584452ba03a54f}{namei}}(old)) == 0)\{}
\DoxyCodeLine{00129     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00130     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00131   \}}
\DoxyCodeLine{00132 }
\DoxyCodeLine{00133   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{00134   \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}})\{}
\DoxyCodeLine{00135     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{00136     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00137     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00138   \}}
\DoxyCodeLine{00139 }
\DoxyCodeLine{00140   ip-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}}++;}
\DoxyCodeLine{00141   \mbox{\hyperlink{defs_8h_a2ee6784c123b2a2656d88b5b357f2253}{iupdate}}(ip);}
\DoxyCodeLine{00142   \mbox{\hyperlink{defs_8h_af301c10ad8ced77a5dfb2de3a64c666c}{iunlock}}(ip);}
\DoxyCodeLine{00143 }
\DoxyCodeLine{00144   \textcolor{keywordflow}{if}((dp = \mbox{\hyperlink{defs_8h_a699674601988291ebcc47d902f18bee8}{nameiparent}}(\textcolor{keyword}{new}, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}})) == 0)}
\DoxyCodeLine{00145     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{00146   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(dp);}
\DoxyCodeLine{00147   \textcolor{keywordflow}{if}(dp-\/>\mbox{\hyperlink{structinode_a121742a89c4531f03a7de1613d5be605}{dev}} != ip-\/>\mbox{\hyperlink{structinode_a121742a89c4531f03a7de1613d5be605}{dev}} || \mbox{\hyperlink{defs_8h_ae4ccea0aa02557162963e597737f665a}{dirlink}}(dp, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}, ip-\/>\mbox{\hyperlink{structinode_a8acc2b9df0bfc6856da62925763db7fe}{inum}}) < 0)\{}
\DoxyCodeLine{00148     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(dp);}
\DoxyCodeLine{00149     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{00150   \}}
\DoxyCodeLine{00151   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(dp);}
\DoxyCodeLine{00152   \mbox{\hyperlink{defs_8h_a29530a0afdfe924818d8c70b6724528d}{iput}}(ip);}
\DoxyCodeLine{00153 }
\DoxyCodeLine{00154   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00155 }
\DoxyCodeLine{00156   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00157 }
\DoxyCodeLine{00158 bad:}
\DoxyCodeLine{00159   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{00160   ip-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}}-\/-\/;}
\DoxyCodeLine{00161   \mbox{\hyperlink{defs_8h_a2ee6784c123b2a2656d88b5b357f2253}{iupdate}}(ip);}
\DoxyCodeLine{00162   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{00163   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00164   \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00165 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_a759600870314007ac558871239122fb7_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_a057e5bce2de7a87ebfd2dc33967bca4a}\label{sysfile_8c_a057e5bce2de7a87ebfd2dc33967bca4a}} 
\index{sysfile.c@{sysfile.c}!sys\_mkdir@{sys\_mkdir}}
\index{sys\_mkdir@{sys\_mkdir}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_mkdir()}{sys\_mkdir()}}
{\footnotesize\ttfamily int sys\+\_\+mkdir (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00336}{336}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00337 \{}
\DoxyCodeLine{00338   \textcolor{keywordtype}{char} *path;}
\DoxyCodeLine{00339   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip;}
\DoxyCodeLine{00340 }
\DoxyCodeLine{00341   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{00342   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path) < 0 || (ip = create(path, \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}}, 0, 0)) == 0)\{}
\DoxyCodeLine{00343     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00344     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00345   \}}
\DoxyCodeLine{00346   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{00347   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00348   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00349 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_a057e5bce2de7a87ebfd2dc33967bca4a_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_a25697aa3d828b5878d38170d724adb27}\label{sysfile_8c_a25697aa3d828b5878d38170d724adb27}} 
\index{sysfile.c@{sysfile.c}!sys\_mknod@{sys\_mknod}}
\index{sys\_mknod@{sys\_mknod}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_mknod()}{sys\_mknod()}}
{\footnotesize\ttfamily int sys\+\_\+mknod (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00352}{352}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00353 \{}
\DoxyCodeLine{00354   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip;}
\DoxyCodeLine{00355   \textcolor{keywordtype}{char} *path;}
\DoxyCodeLine{00356   \textcolor{keywordtype}{int} \mbox{\hyperlink{structinode_a34af7242018a977dace5730683850875}{major}}, \mbox{\hyperlink{structinode_a37878866e7905b666db2aa33076076a2}{minor}};}
\DoxyCodeLine{00357 }
\DoxyCodeLine{00358   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{00359   \textcolor{keywordflow}{if}((\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path)) < 0 ||}
\DoxyCodeLine{00360      \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(1, \&\mbox{\hyperlink{structinode_a34af7242018a977dace5730683850875}{major}}) < 0 ||}
\DoxyCodeLine{00361      \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(2, \&\mbox{\hyperlink{structinode_a37878866e7905b666db2aa33076076a2}{minor}}) < 0 ||}
\DoxyCodeLine{00362      (ip = create(path, \mbox{\hyperlink{stat_8h_a62b045a3e4fdf204bdddda0f3fc3d8c4}{T\_DEV}}, \mbox{\hyperlink{structinode_a34af7242018a977dace5730683850875}{major}}, \mbox{\hyperlink{structinode_a37878866e7905b666db2aa33076076a2}{minor}})) == 0)\{}
\DoxyCodeLine{00363     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00364     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00365   \}}
\DoxyCodeLine{00366   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{00367   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00368   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00369 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_a25697aa3d828b5878d38170d724adb27_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_a74e45efc661ca17c068bc283b3842e6d}\label{sysfile_8c_a74e45efc661ca17c068bc283b3842e6d}} 
\index{sysfile.c@{sysfile.c}!sys\_open@{sys\_open}}
\index{sys\_open@{sys\_open}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_open()}{sys\_open()}}
{\footnotesize\ttfamily int sys\+\_\+open (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00286}{286}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00287 \{}
\DoxyCodeLine{00288   \textcolor{keywordtype}{char} *path;}
\DoxyCodeLine{00289   \textcolor{keywordtype}{int} fd, omode;}
\DoxyCodeLine{00290   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{00291   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip;}
\DoxyCodeLine{00292 }
\DoxyCodeLine{00293   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path) < 0 || \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(1, \&omode) < 0)}
\DoxyCodeLine{00294     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00295 }
\DoxyCodeLine{00296   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{00297 }
\DoxyCodeLine{00298   \textcolor{keywordflow}{if}(omode \& \mbox{\hyperlink{fcntl_8h_ab40a23079c3b9a7e25ffdc8108c7fb02}{O\_CREATE}})\{}
\DoxyCodeLine{00299     ip = create(path, \mbox{\hyperlink{stat_8h_a0a8afbed81f5fb3930e9d153fbd51737}{T\_FILE}}, 0, 0);}
\DoxyCodeLine{00300     \textcolor{keywordflow}{if}(ip == 0)\{}
\DoxyCodeLine{00301       \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00302       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00303     \}}
\DoxyCodeLine{00304   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00305     \textcolor{keywordflow}{if}((ip = \mbox{\hyperlink{defs_8h_acde7d3975db286253e584452ba03a54f}{namei}}(path)) == 0)\{}
\DoxyCodeLine{00306       \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00307       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00308     \}}
\DoxyCodeLine{00309     \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{00310     \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}} \&\& omode != \mbox{\hyperlink{fcntl_8h_a7a68c9ffaac7dbcd652225dd7c06a54b}{O\_RDONLY}})\{}
\DoxyCodeLine{00311       \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{00312       \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00313       \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00314     \}}
\DoxyCodeLine{00315   \}}
\DoxyCodeLine{00316 }
\DoxyCodeLine{00317   \textcolor{keywordflow}{if}((f = \mbox{\hyperlink{defs_8h_ac56b15561658d0e74ce1c53309b8f97d}{filealloc}}()) == 0 || (fd = fdalloc(f)) < 0)\{}
\DoxyCodeLine{00318     \textcolor{keywordflow}{if}(f)}
\DoxyCodeLine{00319       \mbox{\hyperlink{defs_8h_ac865ee0b2d70f753d61d1fefef9de0f6}{fileclose}}(f);}
\DoxyCodeLine{00320     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{00321     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00322     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00323   \}}
\DoxyCodeLine{00324   \mbox{\hyperlink{defs_8h_af301c10ad8ced77a5dfb2de3a64c666c}{iunlock}}(ip);}
\DoxyCodeLine{00325   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00326 }
\DoxyCodeLine{00327   f-\/>\mbox{\hyperlink{structfile_a3a28c808a8dcd4acf45087ac30c075e7}{type}} = FD\_INODE;}
\DoxyCodeLine{00328   f-\/>\mbox{\hyperlink{structfile_a4fd095f927715574dc2a4f243690e508}{ip}} = ip;}
\DoxyCodeLine{00329   f-\/>\mbox{\hyperlink{structfile_a94a911be6cc1b1326728392d8b40150d}{off}} = 0;}
\DoxyCodeLine{00330   f-\/>\mbox{\hyperlink{structfile_a0c5c8eced8bc562dbbecc8d450a6b646}{readable}} = !(omode \& \mbox{\hyperlink{fcntl_8h_a11b644a8526139c4cc1850dac1271ced}{O\_WRONLY}});}
\DoxyCodeLine{00331   f-\/>\mbox{\hyperlink{structfile_a6e1b641ea1551ac4316a0c11a683df45}{writable}} = (omode \& \mbox{\hyperlink{fcntl_8h_a11b644a8526139c4cc1850dac1271ced}{O\_WRONLY}}) || (omode \& \mbox{\hyperlink{fcntl_8h_abb0586253488ee61072b73557eeb873b}{O\_RDWR}});}
\DoxyCodeLine{00332   \textcolor{keywordflow}{return} fd;}
\DoxyCodeLine{00333 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_a74e45efc661ca17c068bc283b3842e6d_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_a9a70db941def46ec25939e6c2d30e399}\label{sysfile_8c_a9a70db941def46ec25939e6c2d30e399}} 
\index{sysfile.c@{sysfile.c}!sys\_pipe@{sys\_pipe}}
\index{sys\_pipe@{sys\_pipe}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_pipe()}{sys\_pipe()}}
{\footnotesize\ttfamily int sys\+\_\+pipe (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00423}{423}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00424 \{}
\DoxyCodeLine{00425   \textcolor{keywordtype}{int} *fd;}
\DoxyCodeLine{00426   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *rf, *wf;}
\DoxyCodeLine{00427   \textcolor{keywordtype}{int} fd0, fd1;}
\DoxyCodeLine{00428 }
\DoxyCodeLine{00429   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a05c7464938c27eb91540c06ec6137f26}{argptr}}(0, (\textcolor{keywordtype}{void}*)\&fd, 2*\textcolor{keyword}{sizeof}(fd[0])) < 0)}
\DoxyCodeLine{00430     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00431   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a3de41eab56ff42bea4d1ae78bbd1e472}{pipealloc}}(\&rf, \&wf) < 0)}
\DoxyCodeLine{00432     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00433   fd0 = -\/1;}
\DoxyCodeLine{00434   \textcolor{keywordflow}{if}((fd0 = fdalloc(rf)) < 0 || (fd1 = fdalloc(wf)) < 0)\{}
\DoxyCodeLine{00435     \textcolor{keywordflow}{if}(fd0 >= 0)}
\DoxyCodeLine{00436       \mbox{\hyperlink{defs_8h_a3d2327db1e34643f4a9e6a07c8cc62c6}{myproc}}()-\/>\mbox{\hyperlink{structproc_a4a9eb0352efe3fc097c91fccfaac50bd}{ofile}}[fd0] = 0;}
\DoxyCodeLine{00437     \mbox{\hyperlink{defs_8h_ac865ee0b2d70f753d61d1fefef9de0f6}{fileclose}}(rf);}
\DoxyCodeLine{00438     \mbox{\hyperlink{defs_8h_ac865ee0b2d70f753d61d1fefef9de0f6}{fileclose}}(wf);}
\DoxyCodeLine{00439     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00440   \}}
\DoxyCodeLine{00441   fd[0] = fd0;}
\DoxyCodeLine{00442   fd[1] = fd1;}
\DoxyCodeLine{00443   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00444 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_a9a70db941def46ec25939e6c2d30e399_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_a54bf714d9e898cbdcbc061b280bbfae0}\label{sysfile_8c_a54bf714d9e898cbdcbc061b280bbfae0}} 
\index{sysfile.c@{sysfile.c}!sys\_read@{sys\_read}}
\index{sys\_read@{sys\_read}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_read()}{sys\_read()}}
{\footnotesize\ttfamily int sys\+\_\+read (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00070}{70}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00071 \{}
\DoxyCodeLine{00072   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{00073   \textcolor{keywordtype}{int} n;}
\DoxyCodeLine{00074   \textcolor{keywordtype}{char} *p;}
\DoxyCodeLine{00075 }
\DoxyCodeLine{00076   \textcolor{keywordflow}{if}(argfd(0, 0, \&f) < 0 || \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(2, \&n) < 0 || \mbox{\hyperlink{defs_8h_a05c7464938c27eb91540c06ec6137f26}{argptr}}(1, \&p, n) < 0)}
\DoxyCodeLine{00077     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00078   \textcolor{keywordflow}{return} \mbox{\hyperlink{defs_8h_a6bd1db179155944c9d1fbc89d8b7b162}{fileread}}(f, p, n);}
\DoxyCodeLine{00079 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_a54bf714d9e898cbdcbc061b280bbfae0_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_ae1e58ee11d41f643929520d8c1640da7}\label{sysfile_8c_ae1e58ee11d41f643929520d8c1640da7}} 
\index{sysfile.c@{sysfile.c}!sys\_unlink@{sys\_unlink}}
\index{sys\_unlink@{sys\_unlink}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_unlink()}{sys\_unlink()}}
{\footnotesize\ttfamily int sys\+\_\+unlink (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00185}{185}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00186 \{}
\DoxyCodeLine{00187   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip, *dp;}
\DoxyCodeLine{00188   \textcolor{keyword}{struct }\mbox{\hyperlink{structdirent}{dirent}} de;}
\DoxyCodeLine{00189   \textcolor{keywordtype}{char} \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}[\mbox{\hyperlink{fs_8h_a48246fb9e5cb7f6a71ebc9ebc2f06562}{DIRSIZ}}], *path;}
\DoxyCodeLine{00190   \mbox{\hyperlink{types_8h_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}} off;}
\DoxyCodeLine{00191 }
\DoxyCodeLine{00192   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_afc00cb2e6a06b1021f3d82fa4d0eff07}{argstr}}(0, \&path) < 0)}
\DoxyCodeLine{00193     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00194 }
\DoxyCodeLine{00195   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{00196   \textcolor{keywordflow}{if}((dp = \mbox{\hyperlink{defs_8h_a699674601988291ebcc47d902f18bee8}{nameiparent}}(path, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}})) == 0)\{}
\DoxyCodeLine{00197     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00198     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00199   \}}
\DoxyCodeLine{00200 }
\DoxyCodeLine{00201   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(dp);}
\DoxyCodeLine{00202 }
\DoxyCodeLine{00203   \textcolor{comment}{// Cannot unlink "{}."{} or "{}.."{}.}}
\DoxyCodeLine{00204   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a0206c4090dc4bdfd8481e38057d5b2af}{namecmp}}(\mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}, \textcolor{stringliteral}{"{}."{}}) == 0 || \mbox{\hyperlink{defs_8h_a0206c4090dc4bdfd8481e38057d5b2af}{namecmp}}(\mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}, \textcolor{stringliteral}{"{}.."{}}) == 0)}
\DoxyCodeLine{00205     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{00206 }
\DoxyCodeLine{00207   \textcolor{keywordflow}{if}((ip = \mbox{\hyperlink{defs_8h_aef19d16d1d20d8f7cdcd8ee0d98fc13f}{dirlookup}}(dp, \mbox{\hyperlink{usertests_8c_aee754febd402311e2a552cb0d6ab6629}{name}}, \&off)) == 0)}
\DoxyCodeLine{00208     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{00209   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{00210 }
\DoxyCodeLine{00211   \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}} < 1)}
\DoxyCodeLine{00212     \mbox{\hyperlink{console_8c_a95c0aca5d6d7487933984f08b189917a}{panic}}(\textcolor{stringliteral}{"{}unlink: nlink < 1"{}});}
\DoxyCodeLine{00213   \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}} \&\& !isdirempty(ip))\{}
\DoxyCodeLine{00214     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{00215     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{00216   \}}
\DoxyCodeLine{00217 }
\DoxyCodeLine{00218   \mbox{\hyperlink{defs_8h_a0098886a849eef10803e9f35ceec61b9}{memset}}(\&de, 0, \textcolor{keyword}{sizeof}(de));}
\DoxyCodeLine{00219   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a515876d4653cefef4732806ef7f2833f}{writei}}(dp, (\textcolor{keywordtype}{char}*)\&de, off, \textcolor{keyword}{sizeof}(de)) != \textcolor{keyword}{sizeof}(de))}
\DoxyCodeLine{00220     \mbox{\hyperlink{console_8c_a95c0aca5d6d7487933984f08b189917a}{panic}}(\textcolor{stringliteral}{"{}unlink: writei"{}});}
\DoxyCodeLine{00221   \textcolor{keywordflow}{if}(ip-\/>\mbox{\hyperlink{structinode_a8d74bec2898785c057111c328d23fda2}{type}} == \mbox{\hyperlink{stat_8h_a91136bcd71a9f499304f5d7e7e9d6376}{T\_DIR}})\{}
\DoxyCodeLine{00222     dp-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}}-\/-\/;}
\DoxyCodeLine{00223     \mbox{\hyperlink{defs_8h_a2ee6784c123b2a2656d88b5b357f2253}{iupdate}}(dp);}
\DoxyCodeLine{00224   \}}
\DoxyCodeLine{00225   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(dp);}
\DoxyCodeLine{00226 }
\DoxyCodeLine{00227   ip-\/>\mbox{\hyperlink{structinode_af8b88b409bea7ef99c49a55f387538b2}{nlink}}-\/-\/;}
\DoxyCodeLine{00228   \mbox{\hyperlink{defs_8h_a2ee6784c123b2a2656d88b5b357f2253}{iupdate}}(ip);}
\DoxyCodeLine{00229   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{00230 }
\DoxyCodeLine{00231   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00232 }
\DoxyCodeLine{00233   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00234 }
\DoxyCodeLine{00235 bad:}
\DoxyCodeLine{00236   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(dp);}
\DoxyCodeLine{00237   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{00238   \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00239 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_ae1e58ee11d41f643929520d8c1640da7_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{sysfile_8c_a687d939a9e4792af15db96f2c2f34378}\label{sysfile_8c_a687d939a9e4792af15db96f2c2f34378}} 
\index{sysfile.c@{sysfile.c}!sys\_write@{sys\_write}}
\index{sys\_write@{sys\_write}!sysfile.c@{sysfile.c}}
\doxysubsubsection{\texorpdfstring{sys\_write()}{sys\_write()}}
{\footnotesize\ttfamily int sys\+\_\+write (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{sysfile_8c_source_l00082}{82}} of file \mbox{\hyperlink{sysfile_8c_source}{sysfile.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00083 \{}
\DoxyCodeLine{00084   \textcolor{keyword}{struct }\mbox{\hyperlink{structfile}{file}} *f;}
\DoxyCodeLine{00085   \textcolor{keywordtype}{int} n;}
\DoxyCodeLine{00086   \textcolor{keywordtype}{char} *p;}
\DoxyCodeLine{00087 }
\DoxyCodeLine{00088   \textcolor{keywordflow}{if}(argfd(0, 0, \&f) < 0 || \mbox{\hyperlink{defs_8h_a75bc8d8c7ea0b4b39d4f470e18e0dba7}{argint}}(2, \&n) < 0 || \mbox{\hyperlink{defs_8h_a05c7464938c27eb91540c06ec6137f26}{argptr}}(1, \&p, n) < 0)}
\DoxyCodeLine{00089     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{00090   \textcolor{keywordflow}{return} \mbox{\hyperlink{defs_8h_a90e8980df48fa900fc33de53448a2e18}{filewrite}}(f, p, n);}
\DoxyCodeLine{00091 \}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d14/sysfile_8c_a687d939a9e4792af15db96f2c2f34378_cgraph}
\end{center}
\end{figure}
